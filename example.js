{
    "success": true,
    "tests": [
        {
            "learnerId": {
                "_id": "67cb06b29018b4ef6e5b9dc3",
                "fullName": "John",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9876543210",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "Male",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "signature": " (Select File)",
                "aadharCard": " (Select File)",
                "educationCertificate": " (Select File)",
                "passport": " (Select File)",
                "notary": " (Select File)",
                "licenseNumber": " DL1234567890",
                "llrNumber": " LLR9876543210",
                "admissionNumber": " ADM123456",
                "userId": "67cb06b29018b4ef6e5b9dc2",
                "createdAt": "2025-03-07T14:46:10.303Z",
                "updatedAt": "2025-03-12T04:38:37.537Z",
                "__v": 0
            },
         "all test":[
             { 
              "_id": "67d2e21ba45681709bca5038",
              "testType": "Mock Test",
              "date": "2025-03-15T00:00:00.000Z",
              "result": "Scheduled",
              "createdAt": "2025-03-13T13:48:11.520Z",
              "updatedAt": "2025-03-13T13:48:11.520Z",
              "__v": 0
          },
          {
              "_id": "67d2e240a45681709bca503c",
              "testType": "Mock Test",
              "date": "2025-03-13T00:00:00.000Z",
              "result": "Scheduled",
              "createdAt": "2025-03-13T13:48:48.814Z",
              "updatedAt": "2025-03-13T13:48:48.814Z",
              "__v": 0
          }
       ]
}      
    ]
} 


:photo_ADM202501 ,signature_ADM202501,aadharCard_ADM202501,educationCertificate_ADM202501,passport_ADM202501
ðŸ“‚ Main Drive Folder parent folder 1vj7Yl8OrA59OtwF6afFqkQ3qzXVhEmwv) 
   â”œâ”€â”€ ðŸ“‚ ADM202503 (Learner's Folder)
       â”œâ”€â”€ ðŸ“„ photo_ADM202503.jpg
       â”œâ”€â”€ ðŸ“„ signature_ADM202503.jpg (latest)
       â”œâ”€â”€ ðŸ“„ aadharCard_ADM202503.pdf (latest)
       â”œâ”€â”€ ðŸ“„ educationCertificate_ADM202503.pdf (latest)
       â”œâ”€â”€ ðŸ“„ passport_ADM202503.pdf (latest)
       â”œâ”€â”€ ðŸ“„ notary_ADM202503.pdf (latest) 


ðŸ“‚ 1vj7Yl8OrA59OtwF6afFqkQ3qzXVhEmwv (Main Parent Folder)
â”œâ”€â”€ ðŸ“„ photo_67e82c969632286c8d8531e3.jpg  (latest)
â”œâ”€â”€ ðŸ“„ photo_67e82c969632286c8d8521e3.jpg  (latest)
â”œâ”€â”€ ðŸ“„ photo_67e82c969632286c8d8541e3.jpg  (latest)

[
    {
        "_id": "67d15db56bb22b3df165cdd9",
        "learner": {
            "_id": "67cb06b29018b4ef6e5b9dc3",
            "fullName": "John",
            "fathersName": "Mr. Doe",
            "mobileNumber": "9876543210",
            "dateOfBirth": "2000-01-01T00:00:00.000Z",
            "gender": "Male",
            "bloodGroup": "B+",
            "address": "123 Main Street, City",
            "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
            "signature": " (Select File)",
            "aadharCard": " (Select File)",
            "educationCertificate": " (Select File)",
            "passport": " (Select File)",
            "notary": " (Select File)",
            "licenseNumber": " DL1234567890",
            "llrNumber": " LLR9876543210",
            "admissionNumber": " ADM123456",
            "userId": "67cb06b29018b4ef6e5b9dc2",
            "createdAt": "2025-03-07T14:46:10.303Z",
            "updatedAt": "2025-03-12T04:38:37.537Z",
            "__v": 0
        },
        "classModal": "Regular",
        "course": [
            {
                "courseId": "67c739d96aa12fbb0cb6df31",
                "status": "Completed",
                "_id": "67d15e516bb22b3df165cde2"
            },
         
        ],
        "createdAt": "2025-03-12T10:11:01.149Z",
        "updatedAt": "2025-03-13T18:29:57.843Z",
        "__v": 2
    },
    {
        "_id": "67d15db56bb22b3df165cdd9",
        "learner": {
            "_id": "67cb06b29018b4ef6e5b9dc3",
            "fullName": "John",
            "fathersName": "Mr. Doe",
            "mobileNumber": "9876543210",
            "dateOfBirth": "2000-01-01T00:00:00.000Z",
            "gender": "Male",
            "bloodGroup": "B+",
            "address": "123 Main Street, City",
            "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
            "signature": " (Select File)",
            "aadharCard": " (Select File)",
            "educationCertificate": " (Select File)",
            "passport": " (Select File)",
            "notary": " (Select File)",
            "licenseNumber": " DL1234567890",
            "llrNumber": " LLR9876543210",
            "admissionNumber": " ADM123456",
            "userId": "67cb06b29018b4ef6e5b9dc2",
            "createdAt": "2025-03-07T14:46:10.303Z",
            "updatedAt": "2025-03-12T04:38:37.537Z",
            "__v": 0
        },
        "classModal": "Regular",
        "course": [
            {
                "courseId": "67cb0d0fe367ba52680c6c95",
                "status": "Cancelled",
                "_id": "67d1653d3f69e4ee0b64de07"
            }
        ],
        "createdAt": "2025-03-12T10:11:01.149Z",
        "updatedAt": "2025-03-13T18:29:57.843Z",
        "__v": 2
    },
    {
        "_id": "67d2e617d6bf965a817e1cde",
        "learner": {
            "_id": "67d2e5749c56473b629e1b2c",
            "fullName": "venkat",
            "fathersName": "Mr. Doe",
            "mobileNumber": "9943751228",
            "dateOfBirth": "2000-01-01T00:00:00.000Z",
            "gender": "Male",
            "bloodGroup": "B+",
            "address": "123 Main Street, City",
            "photo": "(Select File)",
            "signature": " (Select File)",
            "aadharCard": " (Select File)",
            "educationCertificate": " (Select File)",
            "passport": " (Select File)",
            "notary": " (Select File)",
            "licenseNumber": " DL12345678901",
            "llrNumber": " LLR98765432101",
            "admissionNumber": " ADM123456789",
            "userId": "67d2e5749c56473b629e1b2b",
            "createdAt": "2025-03-13T14:02:28.877Z",
            "updatedAt": "2025-03-13T14:02:28.877Z",
            "__v": 0
        },
        "classModal": "Regular",
        "course": [
            {
                "courseId": "67cb0d0fe367ba52680c6c95",
                "status": "Processing",
                "_id": "67d2e617d6bf965a817e1cdf"
            }
        ],
        "createdAt": "2025-03-13T14:05:11.199Z",
        "updatedAt": "2025-03-13T14:05:38.770Z",
        "__v": 1
    },
    {
        "_id": "67d2e617d6bf965a817e1cde",
        "learner": {
            "_id": "67d2e5749c56473b629e1b2c",
            "fullName": "venkat",
            "fathersName": "Mr. Doe",
            "mobileNumber": "9943751228",
            "dateOfBirth": "2000-01-01T00:00:00.000Z",
            "gender": "Male",
            "bloodGroup": "B+",
            "address": "123 Main Street, City",
            "photo": "(Select File)",
            "signature": " (Select File)",
            "aadharCard": " (Select File)",
            "educationCertificate": " (Select File)",
            "passport": " (Select File)",
            "notary": " (Select File)",
            "licenseNumber": " DL12345678901",
            "llrNumber": " LLR98765432101",
            "admissionNumber": " ADM123456789",
            "userId": "67d2e5749c56473b629e1b2b",
            "createdAt": "2025-03-13T14:02:28.877Z",
            "updatedAt": "2025-03-13T14:02:28.877Z",
            "__v": 0
        },
        "classModal": "Regular",
        "course": [
            {
                "courseId": "67cac050e770429dae396ca1",
                "status": "Processing",
                "_id": "67d2e632d6bf965a817e1ce3"
            }
        ],
        "createdAt": "2025-03-13T14:05:11.199Z",
        "updatedAt": "2025-03-13T14:05:38.770Z",
        "__v": 1
    }
] 


courseName,duration, practicalDays, theoryDays, fee 



{
    "success": true,
    "totalPages": 1,
    "currentPage": 1,
    "totalTests": 2,
    "tests": [
        {
            "_id": "67d2e21ba45681709bca5038",
            "learner": {
                "_id": "67cb06b29018b4ef6e5b9dc3",
                "fullName": "John",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9876543210",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "Male",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "signature": " (Select File)",
                "aadharCard": " (Select File)",
                "educationCertificate": " (Select File)",
                "passport": " (Select File)",
                "notary": " (Select File)",
                "licenseNumber": " DL1234567890",
                "llrNumber": " LLR9876543210",
                "admissionNumber": " ADM123456",
                "userId": "67cb06b29018b4ef6e5b9dc2",
                "createdAt": "2025-03-07T14:46:10.303Z",
                "updatedAt": "2025-03-17T16:27:59.129Z",
                "__v": 0,
                "joinDate": "2025-03-07T14:46:10.303Z"
            },
            "testType": "Mock Test",
            "date": "2025-03-15T00:00:00.000Z",
            "result": "Pass",
            "createdAt": "2025-03-13T13:48:11.520Z",
            "updatedAt": "2025-03-13T13:48:11.520Z",
        },
        {
            "_id": "67d2e240a45681709bca503c",
            "learner": {
                "_id": "67cb06b29018b4ef6e5b9dc3",
                "fullName": "John",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9876543210",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "Male",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "signature": " (Select File)",
                "aadharCard": " (Select File)",
                "educationCertificate": " (Select File)",
                "passport": " (Select File)",
                "notary": " (Select File)",
                "licenseNumber": " DL1234567890",
                "llrNumber": " LLR9876543210",
                "admissionNumber": " ADM123456",
                "userId": "67cb06b29018b4ef6e5b9dc2",
                "createdAt": "2025-03-07T14:46:10.303Z",
                "updatedAt": "2025-03-17T16:27:59.129Z",
                "__v": 0,
                "joinDate": "2025-03-07T14:46:10.303Z"
            }
            "testType": "Mock Test",
            "date": "2025-03-13T00:00:00.000Z",
            "result": "Scheduled",
            "createdAt": "2025-03-13T13:48:48.814Z",
            "updatedAt": "2025-03-13T13:48:48.814Z",
        }
    ]
} 


i need data like this

{ 
    "totalPages": 1,
    "currentPage": 1,
    "totalAttendances": 5, 
  "attendances": [ 
     {
        "_id": "67d076fbe6e9c2eeca4b4b3e",
        "learner": {
          "_id": "67cb06b29018b4ef6e5b9dc3",
          "fullName": "John", 
        },
        "courseType": {
          "_id": "67c732c3e411caeabfa62eef",
          "courseName": "Driving Course",
          "duration": 5
        },
        "date": "2025-03-07T00:00:00.000Z",
        "checkIn": "10:00 AM",
        "checkOut": "12:00 PM",
        "attendedDays": 5,
        "totalDays": 5,
        "attendancePercentage": "100.00%",
        "attendanceRatio": "5/5"   
     },
     {
        "_id": "67d076fbe6e9c2eeca4b4b3e",
        "learner": {
          "_id": "67cb06b29018b4ef6e5b9dc3",
          "fullName": "John", 
        },
        "courseType": {
          "_id": "67c732c3e411caeabfa62eef",
          "courseName": "Driving Course",
          "duration": 5
        },
        "date": "2025-03-07T00:00:00.000Z",
        "checkIn": "10:00 AM",
        "checkOut": "12:00 PM",
        "attendedDays": 5,
        "totalDays": 5,
        "attendancePercentage": "100.00%",
        "attendanceRatio": "5/5"   
     },
     {
        "_id": "67d076fbe6e9c2eeca4b4b3e",
        "learner": {
          "_id": "67cb06b29018b4ef6e5b9dc3",
          "fullName": "John", 
        },
        "courseType": {
          "_id": "67c732c3e411caeabfa62eef",
          "courseName": "Driving Course",
          "duration": 5
        },
        "date": "2025-03-07T00:00:00.000Z",
        "checkIn": "10:00 AM",
        "checkOut": "12:00 PM",
        "attendedDays": 5,
        "totalDays": 5,
        "attendancePercentage": "100.00%",
        "attendanceRatio": "5/5"   
     },
     {
        "_id": "67d076fbe6e9c2eeca4b4b3e",
        "learner": {
          "_id": "67cb06b29018b4ef6e5b9dc3",
          "fullName": "John", 
        },
        "courseType": {
          "_id": "67c732c3e411caeabfa62eef",
          "courseName": "Driving Course",
          "duration": 5
        },
        "date": "2025-03-07T00:00:00.000Z",
        "checkIn": "10:00 AM",
        "checkOut": "12:00 PM",
        "attendedDays": 5,
        "totalDays": 5,
        "attendancePercentage": "100.00%",
        "attendanceRatio": "5/5"   
     },
     {
        "_id": "67d076fbe6e9c2eeca4b4b3e",
        "learner": {
          "_id": "67cb06b29018b4ef6e5b9dc3",
          "fullName": "John", 
        },
        "courseType": {
          "_id": "67c732c3e411caeabfa62eef",
          "courseName": "Driving Course",
          "duration": 5
        },
        "date": "2025-03-07T00:00:00.000Z",
        "checkIn": "10:00 AM",
        "checkOut": "12:00 PM",
        "attendedDays": 5,
        "totalDays": 5,
        "attendancePercentage": "100.00%",
        "attendanceRatio": "5/5"   
     }, 
 ]
  } 
  
  {
    "success": true,
    "totalPages": 1,
    "currentPage": 1,
    "totalPayments": 5,
    "payments": [
        
        {
            "_id": "67dd13303c7c5c3375f195a5",
            "paymentMethod": "Cash",
            "amount": 5000,
            "date": "2025-03-21T07:20:16.508Z",
            "learner": {
                "_id": "67cb06b29018b4ef6e5b9dc3",
                "fullName": "John",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9876543210",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "female",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "licenseNumber": " DL1234567890",
                "llrNumber": " LLR9876543210",
                "admissionNumber": " ADM123456",
            }
        },
        {
            "_id": "67dd13303c7c5c3375f195a7",
            "paymentMethod": "Cash",
            "amount": 5000,
            "date": "2025-03-21T07:20:16.522Z",
            "learner": {
                "_id": "67cb06b29018b4ef6e5b9dc3",
                "fullName": "John",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9876543210",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "female",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "licenseNumber": " DL1234567890",
                "llrNumber": " LLR9876543210",
                "admissionNumber": " ADM123456",
            }
        },
        {
            "_id": "67dd13303c7c5c3375f195a9",
            "paymentMethod": "Cash",
            "amount": 5000,
            "date": "2025-03-21T07:20:16.523Z",
            "learner": {
                "_id": "67cb06b29018b4ef6e5b9dc3",
                "fullName": "John",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9876543210",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "female",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "licenseNumber": " DL1234567890",
                "llrNumber": " LLR9876543210",
                "admissionNumber": " ADM123456"
             
            }
        },
        {
            "_id": "67dd13303c7c5c3375f195ab",
            "paymentMethod": "Cash",
            "amount": 5000,
            "date": "2025-03-21T07:20:16.546Z",
            "learner": {
                "_id": "67cb06b29018b4ef6e5b9dc3",
                "fullName": "John",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9876543210",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "female",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
              "admissionNumber": " ADM123456",
         
            }
        },
        {
            "_id": "67dd13303c7c5c3375f195b1",
            "paymentMethod": "Cash",
            "amount": 5000,
            "date": "2025-03-21T07:20:16.932Z",
            "learner": {
                "_id": "67cb06b29018b4ef6e5b9dc3",
                "fullName": "John",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9876543210",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "female",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
              "admissionNumber": " ADM123456",
            }
        }
    ]
}  




{
    "success": true,
    "totalPages": 1,
    "currentPage": 1,
    "totalTests": 6,
    "testsCount": 6,
    "tests": [
        {
            "_id": "67e2afe8a0a15e598b2dcd33",
            "learnerId": "67d2e5749c56473b629e1b2c",
            "testType": "Mock Test",
            "date": "2025-03-20T00:00:00.000Z",
            "result": "Scheduled",
            "createdAt": "2025-03-25T13:30:16.859Z",
            "updatedAt": "2025-03-25T13:30:16.859Z",
            "__v": 0,
            "learner": {
                "_id": "67d2e5749c56473b629e1b2c",
                "fullName": "venkat",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9943751228",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "Male",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "signature": " (Select File)",
                "aadharCard": " (Select File)",
                "educationCertificate": " (Select File)",
                "passport": " (Select File)",
                "notary": " (Select File)",
                "licenseNumber": " DL12345678901",
                "llrNumber": " LLR98765432101",
                "admissionNumber": " ADM123456789",
                "userId": "67d2e5749c56473b629e1b2b",
                "createdAt": "2025-03-13T14:02:28.877Z",
                "updatedAt": "2025-03-13T14:02:28.877Z",
                "__v": 0,
                "joinDate": "2025-03-13T14:02:28.877Z"
            }
        },
        {
            "_id": "67e289f618e25660c710d3c1",
            "learnerId": "67d2e5749c56473b629e1b2c",
            "testType": "Mock Test",
            "date": "2025-03-26T00:00:00.000Z",
            "result": "Scheduled",
            "createdAt": "2025-03-25T10:48:22.931Z",
            "updatedAt": "2025-03-25T10:48:22.931Z",
            "__v": 0,
            "learner": {
                "_id": "67d2e5749c56473b629e1b2c",
                "fullName": "venkat",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9943751228",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "Male",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "signature": " (Select File)",
                "aadharCard": " (Select File)",
                "educationCertificate": " (Select File)",
                "passport": " (Select File)",
                "notary": " (Select File)",
                "licenseNumber": " DL12345678901",
                "llrNumber": " LLR98765432101",
                "admissionNumber": " ADM123456789",
                "userId": "67d2e5749c56473b629e1b2b",
                "createdAt": "2025-03-13T14:02:28.877Z",
                "updatedAt": "2025-03-13T14:02:28.877Z",
                "__v": 0,
                "joinDate": "2025-03-13T14:02:28.877Z"
            }
        },
        {
            "_id": "67dd25493c7c5c3375f19628",
            "learnerId": "67d2e5749c56473b629e1b2c",
            "testType": "Mock Test",
            "date": "2025-03-13T00:00:00.000Z",
            "result": "Scheduled",
            "createdAt": "2025-03-21T08:37:29.298Z",
            "updatedAt": "2025-03-21T08:37:29.298Z",
            "__v": 0,
            "learner": {
                "_id": "67d2e5749c56473b629e1b2c",
                "fullName": "venkat",
                "fathersName": "Mr. Doe",
                "mobileNumber": "9943751228",
                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                "gender": "Male",
                "bloodGroup": "B+",
                "address": "123 Main Street, City",
                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                "signature": " (Select File)",
                "aadharCard": " (Select File)",
                "educationCertificate": " (Select File)",
                "passport": " (Select File)",
                "notary": " (Select File)",
                "licenseNumber": " DL12345678901",
                "llrNumber": " LLR98765432101",
                "admissionNumber": " ADM123456789",
                "userId": "67d2e5749c56473b629e1b2b",
                "createdAt": "2025-03-13T14:02:28.877Z",
                "updatedAt": "2025-03-13T14:02:28.877Z",
                "__v": 0,
                "joinDate": "2025-03-13T14:02:28.877Z"
            }
        },]
      
      
      
} 


        

        {
            "success": true,
            "totalPages": 1,
            "currentPage": 1,
            "totalTests": 6,
            "testsCount": 6,
            "tests": [
                {
                    "_id": "67e2afe8a0a15e598b2dcd33",
                    "learnerId": "67d2e5749c56473b629e1b2c",
                    "testType": "Mock Test",
                    "date": "2025-03-20T00:00:00.000Z",
                    "result": "Scheduled",
                    "createdAt": "2025-03-25T13:30:16.859Z",
                    "updatedAt": "2025-03-25T13:30:16.859Z",
                    "__v": 0,
                },
                {
                    "_id": "67e289f618e25660c710d3c1",
                    "learnerId": "67d2e5749c56473b629e1b2c",
                    "testType": "Mock Test",
                    "date": "2025-03-26T00:00:00.000Z",
                    "result": "Scheduled",
                    "createdAt": "2025-03-25T10:48:22.931Z",
                    "updatedAt": "2025-03-25T10:48:22.931Z",
                    "__v": 0,
            
                },
                {
                    "_id": "67dd25493c7c5c3375f19628",
                    "learnerId": "67d2e5749c56473b629e1b2c",
                    "testType": "Mock Test",
                    "date": "2025-03-13T00:00:00.000Z",
                    "result": "Scheduled",
                    "createdAt": "2025-03-21T08:37:29.298Z",
                    "updatedAt": "2025-03-21T08:37:29.298Z",
                    "__v": 0,
                },]}
                
                

                export const getAllTests = async (req, res) => {
                    try {
                      const { id, testType, result, gender,fromdate, todate, } = req.query;
                      let page = parseInt(req.query.page, 10);
                      let limit = parseInt(req.query.limit, 10);
                      const search = req.query.search ? req.query.search.trim() : "";
                  
                      // âœ… If page & limit are missing, fetch all data
                      const paginate = !isNaN(page) && !isNaN(limit) && page > 0 && limit > 0;
                  
                      // âœ… Match filters
                      const matchFilter = {};
                  
                      if (id) matchFilter["learner._id"] = new mongoose.Types.ObjectId(id);
                      if (testType) matchFilter["testType"] = { $regex: testType, $options: "i" };
                      if (result) matchFilter["result"] = { $regex: result, $options: "i" };
                      if (gender) matchFilter["learner.gender"] = { $regex: gender, $options: "i" };
                  
                      if (search) {
                        const searchDate = !isNaN(Date.parse(search)) ? new Date(search) : null;
                  
                        matchFilter.$or = [
                          { "learner.fullName": { $regex: search, $options: "i" } },
                          { "learner.fathersName": { $regex: search, $options: "i" } },
                          { "learner.mobileNumber": { $regex: search, $options: "i" } },
                          { "learner.licenseNumber": { $regex: search, $options: "i" } },
                          { "learner.llrNumber": { $regex: search, $options: "i" } },
                          { "learner.admissionNumber": { $regex: `^\\s*${search}\\s*$`, $options: "i" } },
                          { testType: { $regex: search, $options: "i" } },
                          { result: { $regex: search, $options: "i" } },
                          ...(searchDate
                            ? [
                                { date: { $gte: searchDate, $lt: new Date(searchDate.getTime() + 86400000) } },
                              ]
                            : []),
                        ];
                  
                        // âœ… If search is a valid ObjectId, filter by `learner._id`
                        if (mongoose.Types.ObjectId.isValid(search)) {
                          matchFilter.$or.push({ "learner._id": new mongoose.Types.ObjectId(search) });
                        }
                      }
                  
                      // âœ… Get total count of filtered records (before pagination)
                      const totalTestsResult = await Test.aggregate([
                        {
                          $lookup: {
                            from: "learners",
                            localField: "learnerId",
                            foreignField: "_id",
                            as: "learner",
                          },
                        },
                        { $unwind: "$learner" },
                        { $match: matchFilter },
                        { $count: "total" },
                      ]);
                  
                      const totalTests = totalTestsResult.length > 0 ? totalTestsResult[0].total : 0;
                      const totalPages = paginate ? Math.ceil(totalTests / limit) : 1;
                  
                      const pipeline = [
                        {
                          $lookup: {
                            from: "learners",
                            localField: "learnerId",
                            foreignField: "_id",
                            as: "learner",
                          },
                        },
                        {
                          $unwind: { 
                            path: "$learner", 
                            preserveNullAndEmptyArrays: true // âœ… Keep documents even if no matching learner
                          }
                        },
                        { $match: matchFilter }, // âœ… Apply filters after lookup and unwind
                        { $sort: { createdAt: -1 } }, // âœ… Sort by latest createdAt
                       
                      ];
                      
                      // âœ… Conditionally exclude `learner` if `id` is provided
                      // if (id) {
                      //   pipeline.push({ $project: { learner: 0 } });
                      // }
                  
                  
                      // âœ… Apply pagination if applicable
                      if (paginate) {
                        const skip = (page - 1) * limit;
                        pipeline.push({ $skip: skip }, { $limit: limit });
                      }
                  
                      const tests = await Test.aggregate(pipeline);
                  
                      res.status(200).json({
                        success: true,
                        totalPages,
                        currentPage: paginate ? page : 1,
                        totalTests, // âœ… Total number of filtered records
                        testsCount: tests.length,
                        tests, // âœ… Current page's test records
                      });
                    } catch (error) {
                      res.status(500).json({ success: false, message: error.message });
                    }
                  };
                   


                  {
                    "totalRecords": 5,
                    "currentPage": 1,
                    "totalPages": 1,
                    "data": [
                        {
                            "learner": {
                                "_id": "67cb06b29018b4ef6e5b9dc3",
                                "fullName": "John",
                                "mobileNumber": "9876543210",
                                "dateOfBirth": "2000-01-01T00:00:00.000Z",
                                "gender": "female",
                                "bloodGroup": "B+",
                                "address": "123 Main Street, City",
                                "photo": "https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
                                "licenseNumber": " DL1234567890",
                                "llrNumber": " LLR9876543210",
                                "admissionNumber": " ADM123456"
                            },
                            "course": {
                                "_id": "67c732c3e411caeabfa62eef",
                                "courseName": "driving",
                                "duration": 5
                            },
                            "_id":"67e77d7da38c88df36d75065",
                            "courseType": "67c732c3e411caeabfa62eef",
                            "classType": "Theory",
                            "date": "2025-03-29T00:00:00.000Z",
                            "checkIn": "10:00Am",
                            "checkOut": "12:00Pm",
                            "createdAt": "2025-03-29T04:55:08.268Z",
                            "updatedAt": "2025-03-29T04:55:08.268Z",
                            "attendedDays": 5,
                            "totalDays": 5,
                            "attendancePercentage": "100%",
                            "attendanceRatio": "5/5"
                        }
                    ]
                }   

                using matchFilter instead of matchStage,

              modified aggregation pipeline with the additional $lookup steps to populate the createdBy user and their corresponding refId (based on role using refPath logic). Iâ€™m inserting it seamlessly after your $match stage, keeping everything else intact.

                {
                  "totalRecords": 2,
                  "currentPage": 1,
                  "totalPages": 1,
                  "data": [
                    {
                      "_id": "6614465a0d77d8f3f57f3321",
                      "learner": {
                        "_id": "65fdba6e8fc33b2bda001234",
                        "fullName": "Ravi Kumar",
                        "mobileNumber": "9876543210",
                        "dateOfBirth": "1995-06-15T00:00:00.000Z",
                        "gender": "Male",
                        "bloodGroup": "B+",
                        "address": "123, MG Road, Bangalore",
                        "photo": "https://drive.google.com/photo123",
                        "licenseNumber": "KA0123456789",
                        "llrNumber": "LLR987654",
                        "admissionNumber": "ADM1001"
                      },
                      "courseType": "65fdba6e8fc33b2bda00c001",
                      "classType": "Theory",
                      "date": "2025-04-06T00:00:00.000Z",
                      "checkIn": "10:00 AM",
                      "checkOut": "12:00 PM",
                      "createdAt": "2025-04-06T10:10:00.000Z",
                      "updatedAt": "2025-04-06T12:00:00.000Z",
                      "createdBy": {
                        "_id": "65fe12ab34debc0a12ef1234",
                        "role": "Instructor",
                        "username": "johndoe",
                        "refId": "65fe10aa34debc0a12ef0001",
                        "refDetails": {
                          "_id": "65fe10aa34debc0a12ef0001",
                          "fullName": "John Doe",
                          "mobileNumber": "9123456780"
                        }
                      },
                      "course": {
                        "_id": "65fdba6e8fc33b2bda00c001",
                        "courseName": "LMV",
                        "duration": 10
                      },

                      "attendedDays": 6,
                      "totalDays": 10,
                      "attendancePercentage": "60%",
                      "attendanceRatio": "6/10"
                    
                    },
                    {
                      "_id": "6614465a0d77d8f3f57f3322",
                      "learner": {
                        "_id": "65fdba6e8fc33b2bda001234",
                        "fullName": "Ravi Kumar",
                        "mobileNumber": "9876543210",
                        "dateOfBirth": "1995-06-15T00:00:00.000Z",
                        "gender": "Male",
                        "bloodGroup": "B+",
                        "address": "123, MG Road, Bangalore",
                        "photo": "https://drive.google.com/photo123",
                        "licenseNumber": "KA0123456789",
                        "llrNumber": "LLR987654",
                        "admissionNumber": "ADM1001"
                      },
                      "courseType": "65fdba6e8fc33b2bda00c001",
                      "classType": "Practical",
                      "date": "2025-04-07T00:00:00.000Z",
                      "checkIn": "03:00 PM",
                      "checkOut": "04:30 PM",
                      "createdAt": "2025-04-07T15:05:00.000Z",
                      "updatedAt": "2025-04-07T16:30:00.000Z",
                      "createdBy": {
                        "_id": "65fe12ab34debc0a12ef1234",
                        "role": "Instructor",
                        "username": "johndoe",
                        "refId": "65fe10aa34debc0a12ef0001",
                        "refDetails": {
                          "_id": "65fe10aa34debc0a12ef0001",
                          "fullName": "John Doe",
                          "mobileNumber": "9123456780"
                        }
                      },
                      "course": {
                        "_id": "65fdba6e8fc33b2bda00c001",
                        "courseName": "LMV",
                        "duration": 10
                      },
                      "attendedDays": 6,
                      "totalDays": 10,
                      "attendancePercentage": "60%",
                      "attendanceRatio": "6/10"
                     
                    }
                  ]
                } 
                
                









                {
                  "success": true,
                  "currentPage": 1,
                  "totalPages": 1,
                  "totalCount": 6,
                  "dataCount": 6,
                  "data": [
                    {
                      
                      "staff": {
                        "_id": "67f69f5414fd42b1dc56e030",
                        "fullName": "Anjali Sharma",
                        "mobileNumber": "9876543210",
                        "gender": "Female",
                        "email": "anjali@example.com",
                        "designation": "Math Teacher",
                        "department": "Academics"
                      },
                     { "_id": "67f6a49017b62c319b04e005",
                      "date": "2025-04-05T00:00:00.000Z",
                      "checkIn": "2025-04-05T09:00:00.000Z",
                      "checkOut": "2025-04-05T17:00:00.000Z",
                      "status": "Present",
                      "createdAt": "2025-04-09T16:47:12.402Z",
                      "updatedAt": "2025-04-09T16:47:12.402Z",
                      "__v": 0 
                    },
                    {  
                      "_id": "67f6a45817b62c319b04e003",
                      "date": "2025-04-04T00:00:00.000Z",
                      "checkIn": "2025-04-04T09:00:00.000Z",
                      "checkOut": "2025-04-04T17:00:00.000Z",
                      "status": "Absent",
                      "createdAt": "2025-04-09T16:46:16.902Z",
                      "updatedAt": "2025-04-09T16:46:16.902Z",
                      "__v": 0
                    }
                     // ... more records
                    }
                   
                  ]
                }
                
                {
                  "success": true,
                  "totalPayments": 2,
                  "PaymentsCount": 2,
                  "payments": [
                      {
                          "_id": "67fce91e66e3043f1490dccf",
                          "paymentMethod": "UPI",
                          "amount": 4000,
                          "createdBy": {
                              "role": [
                                  "Admin",
                                  "Instructor"
                              ],
                              "username": [
                                  "elaiyavenkat",
                                  "sri"
                              ],
                              "refDetails": {
                                  "_id": [
                                      "67e84533440e905b74bb8763"
                                  ],
                                  "fullName": [
                                      "elaiyavenkat"
                                  ],
                                  "mobileNumber": [
                                      "9943751226"
                                  ],
                                  "photo": [
                                      "https://drive.google.com/file/d/1seyNVJ-mY7U_zGH6n3HZvblIBVkKz_S4/view?usp=drivesdk"
                                  ]
                              }
                          },
                          "date": "2025-04-14T10:53:18.024Z",
                          "learner": {
                              "_id": "67e40150e2d940b2fb7d392d",
                              "fullName": "elaiyakumar",
                              "fathersName": "venkatachalam",
                              "mobileNumber": "9943751235",
                              "dateOfBirth": "2000-01-01T00:00:00.000Z",
                              "gender": "Male",
                              "bloodGroup": "c+",
                              "address": "123 Main Street, City, salem",
                              "photo": "https://drive.google.com/file/d/1IaHjFr5nSPIN_YXf2z92w_q8HFbgxB2s/view?usp=drivesdk?t=1743994075791",
                              "licenseNumber": " DL1234567890",
                              "llrNumber": " LLR9876543210",
                              "admissionNumber": "ADM202503"
                          }
                      },
                      {
                          "_id": "67fce92266e3043f1490dcd1",
                          "paymentMethod": "UPI",
                          "amount": 5000,
                          "createdBy": {
                              "role": [
                                  "Admin",
                                  "Instructor"
                              ],
                              "username": [
                                  "elaiyavenkat",
                                  "sri"
                              ],
                              "refDetails": {
                                  "_id": [
                                      "67e84533440e905b74bb8763"
                                  ],
                                  "fullName": [
                                      "elaiyavenkat"
                                  ],
                                  "mobileNumber": 
                            "9943751226",
                                  "photo":"https://drive.google.com/file/d/1seyNVJ-mY7U_zGH6n3HZvblIBVkKz_S4/view?usp=drivesdk"
                              
               }
                          },
                          "date": "2025-04-14T10:53:22.664Z",
                          "learner": {
                              "_id": "67e40150e2d940b2fb7d392d",
                              "fullName": "elaiyakumar",
                              "fathersName": "venkatachalam",
                              "mobileNumber": "9943751235",
                              "dateOfBirth": "2000-01-01T00:00:00.000Z",
                              "gender": "Male",
                              "bloodGroup": "c+",
                              "address": "123 Main Street, City, salem",
                              "photo": "https://drive.google.com/file/d/1IaHjFr5nSPIN_YXf2z92w_q8HFbgxB2s/view?usp=drivesdk?t=1743994075791",
                              "licenseNumber": " DL1234567890",
                              "llrNumber": " LLR9876543210",
                              "admissionNumber": "ADM202503"
                          }
                      }
                  ]
              } 





              [
                {
                    "learnerId": {
                        "_id": "67e40150e2d940b2fb7d392d",
                        "fullName": "elaiyakumar",
                        "fathersName": "venkatachalam",
                        "mobileNumber": "9943751235",
                        "dateOfBirth": "2000-01-01T00:00:00.000Z",
                        "gender": "Male",
                        "bloodGroup": "c+",
                        "address": "123 Main Street, City, salem",
                        "photo": "https://drive.google.com/file/d/1IaHjFr5nSPIN_YXf2z92w_q8HFbgxB2s/view?usp=drivesdk?t=1743994075791",
                        "signature": "https://drive.google.com/file/d/1IaHjFr5nSPIN_YXf2z92w_q8HFbgxB2s/view?usp=drivesdk?t=1743994075791",
                        "aadharCard": "https://drive.google.com/file/d/1IaHjFr5nSPIN_YXf2z92w_q8HFbgxB2s/view?usp=drivesdk?t=1743994075791",
                        "educationCertificate": "https://drive.google.com/file/d/1IaHjFr5nSPIN_YXf2z92w_q8HFbgxB2s/view?usp=drivesdk?t=1743994075791",
                        "passport": "https://drive.google.com/file/d/1IaHjFr5nSPIN_YXf2z92w_q8HFbgxB2s/view?usp=drivesdk?t=1743994075791",
                        "notary": "https://drive.google.com/file/d/1IaHjFr5nSPIN_YXf2z92w_q8HFbgxB2s/view?usp=drivesdk?t=1743994075791",
                        "licenseNumber": " DL1234567890",
                        "llrNumber": " LLR9876543210",
                        "admissionNumber": "ADM202503",
                        "userId": "67e40150e2d940b2fb7d392e",
                        "joinDate": "2025-03-26T13:29:52.932Z",
                        "createdAt": "2025-03-26T13:29:52.942Z",
                        "updatedAt": "2025-04-07T02:48:09.689Z",
                        "__v": 0
                    },
                    "paymentDetails": [
                        {
                            "_id": "67fce91e66e3043f1490dccf",
                            "paymentMethod": "UPI",
                            "amount": 4000,
                            "date": "2025-04-14T10:53:18.024Z",
                            "createdBy": {
                "role": "Admin",
                "username": "elaiyavenkat",
                "refDetails": {
                    "_id": "67e84533440e905b74bb8763",
                    "fullName": "elaiyavenkat",
                    "mobileNumber": "9943751226",
                    "photo": "https://drive.google.com/file/d/1seyNVJ-mY7U_zGH6n3HZvblIBVkKz_S4/view?usp=drivesdk"
                }
              },
                            "__v": 0
                        },
                        {
                            "_id": "67fce92266e3043f1490dcd1",
                            "paymentMethod": "UPI",
                            "amount": 5000,
                            "date": "2025-04-14T10:53:22.664Z",
                            "createdBy": {
                              "role": "Admin",
                              "username": "elaiyavenkat",
                              "refDetails": {
                                  "_id": "67e84533440e905b74bb8763",
                                  "fullName": "elaiyavenkat",
                                  "mobileNumber": "9943751226",
                                  "photo": "https://drive.google.com/file/d/1seyNVJ-mY7U_zGH6n3HZvblIBVkKz_S4/view?usp=drivesdk"
                              }
                            },
                                  
                            "__v": 0
                        }
                    ]
                }
            ]







            const createLearner = async (req, res) => {
    
  const session = await mongoose.startSession();
  session.startTransaction();
  let learnerFolderId;

  try {
    const { username, mobileNumber, password, role } = req.body;

    if (!username || !mobileNumber || !password) {
      return res.status(400).json({ message: "Username, Mobile Number, and Password are required" });
    }
    if (role !== "Learner") {
      return res.status(403).json({ message: "Only Learners can be created" });
    }

    const existingLearner = await Learner.findOne({ mobileNumber });
    if (existingLearner) {
      return res.status(409).json({ message: "Learner with this mobile number already exists" });
    }

    const admissionNumber = await generateAdmissionNumber();
    

    try {
      learnerFolderId = await createDriveFolder(admissionNumber);
    } catch (err) {
      console.error("Error creating Drive folder:", err);
      return res.status(500).json({ message: "Failed to create Drive folder" });
    }

    const fileUrls = {};
    const fileFields = ["photo", "signature", "aadharCard", "educationCertificate", "passport", "notary"];

    if (req.files) {
      for (const field of fileFields) {
        if (req.files[field]) {
          const file = req.files[field][0];

          // âœ… Generate a new file name: "photo_ADM202501", "signature_ADM202501", etc.
          const fileExtension = file.originalname.split(".").pop(); // Get file extension
          const newFileName = `${field}_${admissionNumber}`;

          // âœ… Modify the original file object (rename it before upload)
          file.originalname = newFileName;

          // âœ… Upload file with the new name
          const uploadedFile = await uploadAndOverwriteFile(file, learnerFolderId);
          fileUrls[field] = uploadedFile.webViewLink;
        }
      }
    }

    const newLearner = new Learner({
      ...req.body,
      admissionNumber,
      folderId: learnerFolderId,
      userId: null,
      ...fileUrls,
    });

    const newUser = new User({ username, mobileNumber, password, role });
    newUser.refId = newLearner._id;
    newLearner.userId = newUser._id;

    await newLearner.save({ session });
    await newUser.save({ session });

    await session.commitTransaction();
    session.endSession();

    res.status(201).json({
      message: "Learner created successfully",
      learnerId: newLearner._id,
      learnerData: newLearner,
    });

  } catch (error) {
    await session.abortTransaction();
    session.endSession();
    console.error("Error creating learner:", error);
       // ðŸ”¥ Delete the folder if MongoDB fails
       if (learnerFolderId) {
        await deleteFolderFromDrive(learnerFolderId);
      }
    res.status(500).json({ message: "Error creating learner", error: error.message });
  }
 };